<% content_for :javascript do %>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56222602-1', 'auto');
  ga('send', 'pageview');

</script>
<% end %>



<!-- <div class="center jumbotron"> -->
<div class="jumbotron">
  <div class="container">
    <div class="col-md-12">
      <h1>Energy Storage Stats</h1>
    </div>
    <div class="col-md-6">
    	<h2>
    		Energy Storage Stats is a resource in alpha-release for energy storage researchers and technologists.
    	</h2>
    </div>
    <div class="col-md-6">
      <h2>
        <%= link_to "Submit data", submit_path %> on academic and industrial energy storage devices.
      </h2>
    </div>
  </div>
</div>

<div class="scatter" style="text-align:center;"></div>

<% content_for :javascript do %>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script type='text/javascript'>

var margin = {top: 110, right: 80, bottom: 68, left: 120},
    width = 900 - margin.left - margin.right,
    height = 510 - margin.top - margin.bottom;

var x = d3.scale.log()
    .range([0, width]);

var y = d3.scale.log()
    .range([height, 0]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var tooltip = d3.select(".scatter").append("div") 
    .attr("class", "tooltip")       
    .style("opacity", 0);

// http://bl.ocks.org/Caged/6476579 //
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "E = " + d.volEnergyDen + " Wh/cm3<br> </br>P = " +d.volPowerDen + " W/cm3<br> </br>" + d.citationShort + "<br> </br>" + d.deviceType;
  })
  //

var svg = d3.select("div.scatter").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .style("background", "white")
    // .style("background", "linear-gradient(to bottom left, #f6f6f6, white 10%)")
    // .style("background", "linear-gradient(to bottom, #f6f6f6, white 10%)")
    .style("outline", "thin solid #A7D7F9")
    // .style("outline-width", "1px")
    // .style("outline-style", "solid")
    // .style("outline-image", "linear-gradient(to top, #A7D7F9, white;")
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// http://bl.ocks.org/Caged/6476579 //
svg.call(tip);
//

// var s = d3.scale.log().domain([0.001, 10]).range([0.001, 10]);

// d3.tsv("assets/sampleESSdata.tsv", function(error, data) {
d3.json("assets/ESSdataValpha2.json", function(error, data) {  
  data.forEach(function(d) {
    d.volEnergyDen = +d.volEnergyDen;
    d.volPowerDen = +d.volPowerDen;
  });

  x.domain(d3.extent(data, function(d) { return d.volPowerDen; })).nice();
  y.domain(d3.extent(data, function(d) { return d.volEnergyDen; })).nice();

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis
        .tickFormat(function (d) {
          return x.tickFormat(4,d3.format(",g"))(d)
        }))
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", 40)
      .style("text-anchor", "end")
      .text("Volumetric Power Density (W/cm3)");
    // .selectAll(".tick text")
    //   .text(null)
    // .filter(powerOfTen)
    //   .text(d);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis
        .tickFormat(function (d) {
          return y.tickFormat(4,d3.format(",g"))(d)
        }))
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", -50)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Volumetric Energy Density (Wh/cm3)");

  svg.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 5)
      .attr("cx", function(d) { return x(d.volPowerDen); })
      .attr("cy", function(d) { return y(d.volEnergyDen); })
      .style("fill", function(d) { return color(d.deviceType); })
      // http://bl.ocks.org/Caged/6476579 //
      .on('mouseover', 
        // d3.select("circle.dot")
        //   .attr("r", 10),
        tip.show)
      .on('mouseout', tip.hide)
      //
      .on('click', function(d,i) { var text = d3.select("div.scatter").append("div").append("text")
        .data(data)
        .style("fill", "black")
        .attr("x", 0)
        .attr("y", 0)
        .text(function() { return d.citationLong; })
        })
    // .append("svg:title")
    //   .text(function(d, i) { return d.deviceType; });

  var legend = svg.selectAll(".legend")
      .data(color.domain())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width + margin.right - 36)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  legend.append("text")
      .attr("x", width + margin.right - 42)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });

  svg.append("text")
      .attr("x", 0)
      .attr("y", 0 - (margin.top / 2))
      // .attr("dy", "0.8em")
      .attr("text-anchor", "start")
      .style("font-size", "2em")
      .style("font-family", "Georgia")
      // .style("font-style", "italic")
      // .style("text-decoration", "underline")
      .text("Volumetric Ragone Chart");

});

var instructions = d3.select("div.scatter")
    .append("div")
    .append("text")
        // .append("svg")
    .attr("x", 100)
    .attr("y", 100)
    .style("font-style", "italic")
    .text("Click data points to add their citations here.");


</script>

<% end %>


<div class="center jumbotron">
  <div class="container">
    <div class="col-md-6">
      <h3>
        The goal of EnergyStorageStats is to collect and interactively display data on a broad range of energy storage devices.  We've started with a volumetric Ragone plot because energy and power densities are widely reported, and volume (as opposed to mass) dominates the density metric at the small and large ends of device sizes.  More data is on the way.
      </h3>
    </div>
    <div class="col-md-6">
      <h3>
        A gravimetric Ragone plot is coming next.  Ultimately, we aim to present data on as many devices as possible, linking available metrics of a device throughout customizable, interactive plots.  The best way to make sure your device is included here is to <%= link_to "submit data", submit_path %>.
      </h3>
    </div>
  </div>
  <div class="container">
    <div class="col-md-6">
      <h2><i>Steven Chu: "Energy storage is a big deal" (2010).</i></h2>
    </div>
    <div class="col-md-6">
      <h2><i>Bill Nye: "If we could find a way to efficiently store electricity, we would change the world and make a much higher quality life for everybody" (2014).</i></h2>
    </div>
  </div>
</div>



